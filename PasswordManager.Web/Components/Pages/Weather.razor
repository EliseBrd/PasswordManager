@page "/weather"
@using Microsoft.Identity.Abstractions
@inject IDownstreamApi DownstreamApi
@attribute [Authorize]
@rendermode InteractiveServer

<h3>User Claims</h3>

@if (userClaims == null)
{
    <p><em>Chargement...</em></p>
}
else
{
    <ul>
        @foreach (var claim in userClaims)
        {
            <li><b>@claim.Type:</b> @claim.Value</li>
        }
    </ul>
}

@code {
    private List<ClaimDto>? userClaims;

    class ClaimDto
    {
        public string? Type { get; set; }
        public string? Value { get; set; }
    }

    protected override async Task OnInitializedAsync()
    {
        try
        {
            userClaims = await DownstreamApi.CallApiForUserAsync<List<ClaimDto>>(
                "PasswordManager.api",  // Nom configuré dans Program.cs avec AddDownstreamApi
                options =>
                {
                    options.HttpMethod = "GET";
                    options.RelativePath = "Claims"; // correspond à ton ClaimsController
                });
        }
        catch (Exception ex)
        {
            Console.WriteLine(ex);
            userClaims = new List<ClaimDto>
            {
                new ClaimDto { Type = "Erreur", Value = ex.Message }
            };
        }
    }
}
